!function(o){var t;o.smartPopover={version:"0.8"},o.fn.smartPopover=function(r,e){var s=this,a=function(t){t&&t.target&&o(t.target).parents().andSelf().filter(".js-smartpopover,.js-smartpopover-target").length>0||(o(s).removeClass("js-smartpopover-target"),o(s).off("mousemove",B),o(window).off("resize scroll",B),o(s).off("redraw",B),o(document).off("mousedown",a),o(".js-smartpopover").fadeOut(100,function(){o(this).remove()}))};if("destroy"===r)return a(),this;e=e||{};var i=e.always||!0,p=e.arrowsize||12,h=e.arrowwidth||12,d=e.arrowmargin||1,x=e["background-color"]||"#f5f5f5",w=e["background-color2"]||x,n=e["border-radius"]!==t?e["border-radius"]:"4px",l=e["arrow-color"]||x,y=e.margin||{w:24,h:24},b=e.only!==t?e.only:!0,f=e.outerclickclose!==t?e.outerclickclose:!0,c="z-index"in e?e["z-index"]:1e4;b&&o(".js-smartpopover-target").smartPopover("destroy"),o(s).addClass("js-smartpopover-target");var g=o("<div/>").addClass("js-smartpopover").css({position:"absolute",left:0,top:0,overflow:"visible","z-index":c}).appendTo("body"),v=o(r).css({position:"absolute",opacity:0}).appendTo(g),m={w:v.width(),h:v.height()};v.hide();var u=o(s).offset(),k=o("<div/>").css({position:"absolute",left:u.left-m.w/2,top:u.top-m.h/2,overflow:"auto",width:m.w+2*y.w,height:m.h+2*y.h,"background-color":x,"border-radius":n,"text-shadow":"1px -1px rgba(0, 0, 0, .1)","box-sizing":"border-box",border:"1px solid rgba(0, 0, 0, .1)","box-shadow":"3px 3px 3px rgba(0, 0, 0, .08), 1px 1px 0 rgba(255, 255, 255, .13) inset","background-image":"linear-gradient("+x+" 0,"+w+" 100%)"}).appendTo(g);v.css({left:y.w,top:y.h,opacity:1}).appendTo(k).show(),m.w=m.w+2*y.w,m.h=m.h+2*y.h;for(var z={w:m.w,h:m.h},j=p+d,T=[],C=[l,"rgba(0, 0, 0, .2)"],P=0;2>P;P++){var I=h+"px solid transparent",L=p+"px solid "+C[P];T[P]={left:{"border-left":L,"border-top":I,"border-bottom":I,"border-right":"",left:-1*j-2+P,top:-1*h},right:{"border-left":"","border-top":I,"border-bottom":I,"border-right":L,left:d+2-P,top:-1*h},bottom:{"border-left":I,"border-top":"","border-bottom":L,"border-right":I,left:-1*h,top:d+2-P},top:{"border-left":I,"border-top":L,"border-bottom":"","border-right":I,left:-1*h,top:-1*j-2+P}}}var O=o("<div/>").css({position:"absolute","z-index":c+1}).prependTo(g),Q=o("<div/>").css({position:"absolute",left:0,top:0,width:0,height:0,"z-index":c+3}).appendTo(O),S=o("<div/>").css({position:"absolute",left:0,top:0,width:0,height:0,"z-index":c+2}).appendTo(O),q={},A={};g.hide();var B=function(){u=o(s).offset();var t={x:u.left,y:u.top,w:o(s).width(),h:o(s).height()},r={x:o(window).scrollLeft(),y:o(window).scrollTop(),w:o(window).width(),h:o(window).height()};if(q.x!==t.x||q.y!==t.y||q.w!==t.w||q.h!==t.h||A.x!==r.x||A.y!==r.y||A.w!==r.w||A.h!==r.h){q=t,A=r;var e={left:{x:t.x,y:t.y+t.h/2},right:{x:t.x+t.w,y:t.y+t.h/2},top:{x:t.x+t.w/2,y:t.y},bottom:{x:t.x+t.w/2,y:t.y+t.h}},a=2*h+4;o.each(e,function(o,t){e[o].x=t.x>r.x+r.w-a?r.x+r.w-a:t.x<r.x+a?r.x+a:t.x,e[o].y=t.y>r.y+r.h-a?r.y+r.h-a:t.y<r.y+a?r.y+a:t.y});var i=r.w-z.w>0,p=r.h-z.h>0;m.w=i?z.w:r.w,m.h=p?z.h:r.h,k.css({width:m.w,height:m.h});var d={left:{p:e.left.x-r.x-m.w-j},right:{p:r.x+r.w-e.right.x-m.w-j},top:{p:e.top.y-r.y-m.h-j},bottom:{p:r.y+r.h-e.bottom.y-m.h-j}};d.left.ok=d.left.p>0,d.right.ok=d.right.p>0,d.top.ok=d.top.p>0,d.bottom.ok=d.bottom.p>0;var x=null,w=0;o.each(d,function(o,t){t.ok&&w<t.p&&(x=o,w=t.p)}),null===x&&(w=-9999999,o.each(d,function(o,t){w<t.p&&(x=o,w=t.p)}));var n=e[x],l={};switch(x){case"top":l.x=n.x-m.w/2,l.y=n.y-(m.h+j);break;case"bottom":l.x=n.x-m.w/2,l.y=n.y+j;break;case"left":l.x=n.x-(m.w+j),l.y=n.y-m.h/2;break;case"right":l.x=n.x+j,l.y=n.y-m.h/2}a=h,l.y=l.y+m.h>r.y+r.h-a?l.y-(l.y+m.h-(r.y+r.h-a)):l.y<r.y+a?r.y+a:l.y,l.x=l.x+m.w>r.x+r.w-a?l.x-(l.x+m.w-(r.x+r.w-a)):l.x<r.x+a?r.x+a:l.x,k.css({left:l.x,top:l.y});var y={};switch(x){case"left":y.x=l.x+m.w+j,y.y=n.y;break;case"right":y.x=l.x-j,y.y=n.y;break;case"top":y.x=n.x,y.y=l.y+m.h+j;break;case"bottom":y.x=n.x,y.y=l.y-j}Q.css(T[0][x]),S.css(T[1][x]),O.css({x:y.x,y:y.y})}};g.fadeIn(100),B(),i&&(o(window).on("resize scroll",B),o(document).on("mousemove",B),o(s).on("redraw",B)),f&&o(document).on("mousedown",a)}}(jQuery);