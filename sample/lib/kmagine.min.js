var kSound=kSound||{},kState=kState||{},km=km||{},_km=_km||{};km.resource_json=km.resource_json||{},km.scene_json=km.scene_json||{},km.imgs=km.imgs||{},km.sounds=km.sounds||{},km.htmls=km.htmls||{},km.scenes=km.scenes||{},km.swfpath="ksound.swf",window.requestAnimFrame=window.requestAnimFrame||function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),function(){function t(t){var e,n,s=t.charAt(0).toUpperCase()+t.slice(1),i=["Moz","Webkit","O","ms"],o=document.createElement("div");if(t in o.style)n=t;else{for(var a=0;a<i.length;a++)if(e=i[a]+s,e in o.style){n=e;break}o=null}return $.support[t]=n,n}function e(){return this.x=0,this.y=0,this.z=0,this.props={},this.props.translate="0,0",this}function n(t,e,n,s){var o=[];$.each(t,function(t){t=$.camelCase(t),t=_km.css_conv_transitionProp[t]||$.cssProps[t]||t,t=i(t),-1===$.inArray(t,o)&&o.push(t)}),km.easing[n]&&(n=km.easing[n]);var r=""+a(e)+" "+n;parseInt(s,10)>0&&(r+=" "+a(s));var m=[];return $.each(o,function(t,e){m.push(e+" "+r)}),m.join(", ")}function i(t){return t.replace(f,function(t){return"-"+t.toLowerCase()})}function o(t,e){return"string"!=typeof t||t.match(k)?""+t+e:t}function a(t){return $.fx.speeds[t]&&(t=$.fx.speeds[t]),o(t,"ms")}function r(){return this.id="",this.uid=v++,this.old_id="",this}function m(){}function c(t,e,n,s){this.bpm=n||0,this.mspb=0!=this.bpm?6e4/n:0,this.id=t,this.loadok=!1,this.load(t,e,n,s)}var u;km.defaultEasing="linear",km.device={udid:"",locale:""},km.easing={swing:"cubic-bezier(.02,.01,.47,1)"},_km.css_conv_transitionProp={},_km.mode3d=!0,_km.imgpath="img/";var l=navigator.userAgent.toLowerCase();_km.vendor=(navigator.vendor||"").toLowerCase(),_km.isiPhone=/iphone/.test(l),_km.isiPad=/ipad/.test(l),_km.isiOS=/apple/.test(_km.vendor)&&/mobile/.test(l),_km.isLocal=/http/.test(location.href),_km.isAndroid=/android/.test(l),_km.isTouch="ontouchstart"in window,_km.isIE=l.match(/msie/i),_km.transition=t("transition"),_km.transform=t("transform"),_km.transitionDelay=t("transitionDelay"),_km.transformOrigin=t("transformOrigin");var h=document.createElement("div");h.style[_km.transform]="",h.style[_km.transform]="rotateY(90deg)",_km.isSupport3d=""!==h.style[_km.transform],h=null;var d=["x","y","z","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotate3d","perspective"],p={z:!0,rotateX:!0,rotateY:!0,rotate3d:!0,perspective:!0,transformOrigin:!0};$.each(d,function(t,n){$.cssHooks[n]={get:function(t){var s=$(t).data("kTransform")||new e,i="get_"+n;return s[i]?s[i]():s.props[n]||0},set:function(t,s){var i,o=$(t).data("kTransform")||new e;""===s?(i="del_"+n,o[i]?o[i]():delete o.props[n]):(i="set_"+n,o[i]?o[i](s):o.props[n]=s.join(",")),t.style[_km.transform]=o.toString(),$(t).data("kTransform",o)}},_km.css_conv_transitionProp[n]=_km.transform,$.cssNumber[n]=!0}),e.prototype={set_rotate:function(t){this.props.rotate=o(t,"deg")},set_rotateX:function(t){this.props.rotateX=o(t,"deg")},set_rotateY:function(t){this.props.rotateY=o(t,"deg")},set_scale:function(t){var e,n;$.isArray(t)?(e=t[0],n=t[1]):e=n=t,this.scaleX=e,this.scaleY=n,this.props.scale=this.scaleX+","+this.scaleY},set_scaleX:function(t){this.scaleX=t,this.scaleY===u&&(this.scaleY=1),this.props.scale=this.scaleX+","+this.scaleY},set_scaleY:function(t){this.scaleY=t,this.scaleX===u&&(this.scaleX=1),this.props.scale=this.scaleX+","+this.scaleY},set_perspective:function(t){this.props.perspective=o(t,"px")},set_x:function(t){null!==t&&t!==u&&(this.x=t),this.props.translate=o(this.x,"px")+","+o(this.y,"px")},set_y:function(t){null!==t&&t!==u&&(this.y=t),this.props.translate=o(this.x,"px")+","+o(this.y,"px")},set_z:function(t){null!==t&&t!==u&&(this.z=t)},get_x:function(){return this.x||0},get_y:function(){return this.y||0},get_z:function(){return this.z||0},get_scale:function(){return this.props.scale?this.scaleX==this.scaleY?this.scaleX:[this.scaleX,this.scaleY]:1},get_scaleX:function(){return this.scaleX||1},get_scaleY:function(){return this.scaleY||1},get_rotate3d:function(){for(var t=(this.props.rotate3d||"0,0,0,0deg").split(","),e=t.length;e--;)t[e]&&(t[e]=parseFloat(t[e]));return t[3]&&(t[3]=o(t[3],"deg")),t},del_x:function(){this.x=0,this.props.translate=o(this.x,"px")+","+o(this.y,"px")},del_y:function(){this.y=0,this.props.translate=o(this.x,"px")+","+o(this.y,"px")},del_z:function(){this.z=0},toString:function(){var t=[];for(var e in this.props)if(this.props.hasOwnProperty(e))if(_km.isSupport3d)"scale"===e?t.push(e+"3d("+this.props[e]+",1)"):"translate"===e?t.push(e+"3d("+this.props[e]+","+o(this.z,"px")+")"):t.push(e+"("+this.props[e]+")");else{if(e in p)continue;t.push(e+"("+this.props[e]+")")}return t.join(" ")}},$.fn.loop=function(){return $.each(this,function(){$(this).data("kLoop",{log:[],rec:!0})}),this},$.fn.endloop=function(){var t=$(this).to(function(){var t=$(this).data("kLoop");if(t&&t.log){for(var e=[],n=0;n<t.log.length;n++)e.push($.extend(!0,{},t.log[n]));$(this).to(e)}},1);return $.each(this,function(){var t=$(this).data("kLoop");t.rec=!1,$(this).data("kLoop",t)}),t},$.fn.stoploop=function(){return $(this).removeData("kLoop"),this},$.fn.to=function(t,e,s,i){var o=this,r=0,m=!0;if(this.length>1)return $.each(this,function(){$(this).to(t,e,s,i)}),this;if("string"==typeof t)return km.toPreset[t]?km.toPreset[t].apply(this,[e,s,i]):this;if("function"==typeof t&&(i=t,t={}),$.isArray(t)){for(var c=this,l=0;l<t.length;l++)c=$(c).to(t[l]);return c}"function"==typeof e&&(i=e,e=u),"function"==typeof s&&(i=s,s=u);var h=$(this).data("kLoop");if(h&&h.rec){var d={};e!==u&&(d.duration=e),i!==u&&(d.complete=i),s!==u&&(d.easing=s),h.log.push($.extend(!0,d,t))}t.complete!==u&&(i=t.complete,delete t.complete),t.queue!==u&&(m=t.queue,delete t.queue),t.easing!==u&&(s=t.easing,delete t.easing),t.delay!==u&&(r=t.delay,delete t.delay),t.duration!==u&&(e=t.duration,delete t.duration),e===u&&(e=0),s===u&&(s=km.defaultEasing),e=a(e);var p=n(t,e,s,r),f=parseInt(e,10)+parseInt(r,10);if(1>f){var k=function(e){o.css(t),"function"==typeof i&&i.apply(o),"function"==typeof e&&e()};return m===!0?o.queue(k):k(),o}var v=function(e){this.offsetWidth;var n=function(){o.css({transition:""}),"function"==typeof i&&i.apply(o),"function"==typeof e&&e()};t.transition=p,o.css(t).setTimeout(n,f)};return m===!0?o.queue(v):v(),o},km.toPreset={scaleIn:function(t,e,n){return $(this).to(function(){$(this).show()}).to({opacity:0,scaleX:"+=0.5",scaleY:"+=0.5"}).to({opacity:1,scaleX:"-=0.5",scaleY:"-=0.5"},t||450,e,n)},scaleOut:function(t,e,n){return $(this).to({opacity:1}).to({opacity:0,scaleX:"+=0.5",scaleY:"+=0.5"},t||450,e,n).to(function(){$(this).hide().css({scaleX:"-=0.5",scaleY:"-=0.5"})})},poyo:function(t,e,n){return $(this).to({y:"+=10",scaleY:"-=0.03",scaleX:"+=0.08"}).to({y:"-=10",scaleY:"+=0.03",scaleX:"-=0.08"},t||85,e||"swing",n)}};var f=/([A-Z])/g,k=/^[\-0-9\.]+$/;$.fn.extend({pos:function(t,e,n,s,i){if(0===arguments.length){var o=window.getComputedStyle(this[0])[_km.transform];return o=new _km.CSSMatrix(o),[o.m41,o.m42]}return $(this).to({x:t,y:e},n,s,i),this},pos3:function(t,e,n,s,i,o){if(0===arguments.length){var a=window.getComputedStyle(this[0])[_km.transform];return a=new _km.CSSMatrix(a),[a.m41,a.m42,a.m43]}return $(this).to({x:t,y:e,z:n},s,i,o),this},stopNow:function(){var t=window.getComputedStyle(this[0])[_km.transform];this[0].style[_km.transform]=t,this[0].style[_km.transition]=null,t=new _km.CSSMatrix(t);var e=this.data("kTransform");return e.x=t.m41,e.y=t.m42,e.z=t.m43,$(this).queue([]).stop(),this},ipos:function(t,e,n,s,i){return $(this).to({x:t,y:e},n,s,i),this},scale:function(t,e,n,s,i){return $(this).to({scale:[t,e]},n,s,i),this},fhide:function(){return $(this).css("x","+=999"),this},fshow:function(){return $(this).css("x","-=999"),this},rotate:function(t,e,n,s){return $(this).to({rotate:t},e,n,s),this},fade:function(t,e,n,s){return $(this).to({opacity:t},e,n,s),this},wait:function(t,e){return $(this).to({delay:t},1,e),this},touchClick:function(t){function e(){if(event.touches[0]){var t=event.touches[0];a.id=$(this).get(0),a.x=t.pageX,a.y=t.pageY,$(this).addClass("js-press")}event.preventDefault()}function n(t){a.id=$(this).get(0),a.x=t.pageX,a.y=t.pageY}function s(){$(this).removeClass("js-press");var t=event.changedTouches[0],e=Math.abs(t.pageX-a.x),n=Math.abs(t.pageY-a.y);a.id==$(this).get(0)&&40>e&&40>n&&o.call(this,t),a.id=null}function i(t){var e=Math.abs(t.pageX-a.x),n=Math.abs(t.pageY-a.y);a.id==$(this).get(0)&&40>e&&40>n&&o.call(this,t),a.id=null}var o=t,a={id:"",x:0,y:0};return _km.isTouch?$(this).on("touchstart",e):$(this).on("mousedown",n),_km.isTouch?$(this).on("touchend",s):$(this).on("mouseup",i),this},setTimeout:function(t,e,n){2===arguments.length&&(n=e,e=t,t="");var s=window.setTimeout($.proxy(e,this),n);""===t&&(t=s);var i=$(this).data("kTime")||{};i[t]=s,$(this).data({kTime:i});var o=this,a=t,r=function(){var t=o.data("kTime");t&&t[a]&&delete t[a],o.data({kTime:t})};return window.setTimeout(r,n),this},clearTimeout:function(t){var e=$(this).data("kTime");if(t===u){for(var n in e)window.clearTimeout(e[n]);$(this).data({kTime:{}})}else e&&t in e&&(window.clearTimeout(e[t]),delete e[t],$(this).data({kTime:e}));return this},setInterval:function(t,e,n){2===arguments.length&&(n=e,e=t,t="");var s=$(this).data("kInterval")||{};s[t]&&$(this).clearInterval(t);var i=window.setInterval($.proxy(e,this),n);return""===t&&(t=i),s[t]=i,$(this).data({kInterval:s}),this},clearInterval:function(t){var e=$(this).data("kInterval");if(0===arguments.length){var n;for(n in e)clearInterval(e[n]);$(this).data({kInterval:{}})}else e&&t in e&&(clearInterval(e[t]),delete e[t],$(this).data({kInterval:e}));return this},onBeat:function(t){this.data("kBeat",t),_km.onbeats.push(this)},flash:function(t,e,n){},shake:function(t,e,n){var s=t,i=n,o=this,a=e,r=function(){var t=0,e=0,n=function(){var n=randint(0,s)-s/2-t,i=randint(0,s)-s/2-e;t+=n,e+=i,n=n>-1?"+="+n:"-="+-1*n,i=i>-1?"+="+i:"-="+-1*i,$(o).css({x:n,y:i})},r=function(){var n=parseInt($(o).css("x"),10),r=parseInt($(o).css("y"),10);$(o).clearInterval("shake"),$(o).css({x:n-t,y:r-e}),i&&i.apply(o),o=s=i=a=t=e=null};$(o).setInterval("shake",n,26),setTimeout(r,a)};return $(this).to({delay:1},1,r),this},scene:function(t,e,n){var s=$(this).data("kSceneState")||new r;return _km.init_f||km.init(),s.set(this,t,e,n),$(this).data("kSceneState",s),this},appendScene:function(t,e,n){s.set(this,t,e,n,!0)},destroy:function(){$(this).contents().andSelf().clearTimeout().clearInterval().stop().attr("id","").stoploop().remove()}});var v=0;if(r.prototype={set:function(t,e,n,s,i){var o=this.id;if(s=s||km.defaultTransitionTime,n=n||km.defaultTransition,""!==o){var a=km.scenes[o];a&&a.onDestroy&&a.onDestroy()}var r=$(".js-scene-"+this.uid);$(r).contents().andSelf().attr("id",""),this.id=e,this.old_id=o;var m=null;if(""!==e){var c=$("<div/>").addClass("js-scene-"+this.uid).css({display:"inline",position:"relative",left:0,top:0,width:0,height:0,overflow:"visible"}).prependTo(t);$(t).offset(),m=km.scenes[e].dom.clone(!0),$(m).css({position:"absolute",overflow:"visible",top:0,left:0,"z-index":1e5,opacity:0}).prependTo(c);var u=km.scenes[e];u&&u.onStart&&u.onStart()}var l=km.transitionPresets[n]?km.transitionPresets[n]:l;return i||""===o?l.apply(this,[null,m,s]):l.apply(this,[r,m,s]),this},get:function(){return this.id},back:function(t,e,n,s){return this.set(t,this.old_id,e,n,s)}},km.defaultTransition="noEffect",km.defaultTransitionTime=300,km.transitionPresets={noEffect:function(t,e){$(t).destroy(),$(e).css({opacity:1})},fade:function(t,e,n){var n=n/2,s=t?n:0;$(t).to({opacity:0},n,"swing",function(){$(this).destroy()}),$(e).to({opacity:1,delay:s},n,"swing")},crossFade:function(t,e,n){$(t).to({opacity:0},n,"swing",function(){$(this).destroy()}),$(e).to({opacity:1},n,"swing")},rotate:function(t,e,n){var n=n/2,s=t?n:0;$(t).to({rotateY:90},n,function(){$(this).destory()}),$(e).to({rotateY:-90,opacity:1,delay:s}).to({rotateY:0},n)}},m.prototype={},_km.loadResourceCSS=function(t){var e=[];for(var n in t){var s="x"in t[n]?o(-1*t[n].x,"px"):0,i="y"in t[n]?o(-1*t[n].y,"px"):0,a="w"in t[n]?o(t[n].w,"px"):0,r="h"in t[n]?o(t[n].h,"px"):0,m="src"in t[n]?"background: transparent url("+_km.imgpath+t[n].src+") "+s+" "+i+" no-repeat;":"";e.push([".sp-",n," {",m," width:",a,"; height:",r,"; }\n"].join(""))}return e.join("")},_km.setValtoObj=function(t,e,n){var s=t;switch(e){case"id":s.attr("id",n);break;case"sprite":s.addClass("sp-"+n);break;case"display":"none"==n&&s.hide();break;case"x":s.css("left",n);break;case"y":s.css("top",n);break;case"z":case"scaleX":case"scaleY":case"opacity":case"overflow":case"rotate":case"rotateX":case"rotateY":case"z-index":s.css(e,n);break;default:return}var i={};i[e]=n,s.data(i)},km.init=function(){var t=_km.loadResourceCSS(_km.resource_json);$('<style type="text/css">'+t+"</style>").appendTo("head");for(var e in _km.scene_json)if(km.scenes[e]=km.scenes[e]||new m,_km.scene_json.hasOwnProperty(e)){var n=$.loadScene($("<div/>"),_km.scene_json[e]);km.scenes[e].dom=n}_km.init_f=!0},_km.cache={},$.extend({loadScene:function(t,e){function n(t,e){for(var s in e){var i=$("<div/>").css({position:"absolute"}).attr("id",""+s);for(var o in e[s])_km.setValtoObj(i,o,e[s][o]);t.append(i),e[s].children&&n(i,e[s].children)}}var s=t;return n(s,e.children),s},c:function(t){return t in _km.cache?_km.cache[t]:$(t)},showModal:function(t,e){return _km.modalZ+=2,this.showOverlay(t,_km.modalZ),$("<div/>").attr("id","modal"+_km.modalZ).css({left:0,top:0,width:"100%",height:"100%",position:"absolute","z-index":z+1}).appendTo(t),$("#modal"+_km.modalZ).append(e)},hideModal:function(){$("#overlay"+_km.modalZ).remove(),$("#modal"+_km.modalZ+"> div > div").unbind(),$("#modal"+_km.modalZ+"> div").scaleOut(300,"ease",function(){$(this).parent().remove()}),_km.modalZ-=2},hideAllModal:function(){$("[id^=overlay]").remove(),$("[id^=modal] > div").unbind(),$("[id^=modal] > div").scaleOut(300,"ease",function(){$(this).remove(),$("[id^=modal]").remove()}),_km.modalZ=1e6},showOverlay:function(t,e){$("<div/>").attr("id","overlay").css({left:0,top:0,width:"100%",height:"100%",position:"absolute","z-index":e}).on("resize",function(){this.css({width:"100%",height:"100%"})}).appendTo(t)}}),_km.modalZ=1e6,_km.fixnum=function(t,e,n){return e>t?e:t>n?n:t},_km.loopnum=function(t,e,n){return(t-e)%(n-e)},_km.chuusen=function(t){var e=randint(0,100);return t>e},_km.time=function(){return(new Date).getTime()},_km.utime2str=function(t){return("0"+Math.floor(t%216e3/3600)).slice(-2)+":"+("0"+Math.floor(t%3600/60)).slice(-2)+":"+("0"+t%60).slice(-2)},_km.utime2datestr=function(t){return dd=new Date,dd.setTime(1e3*t),yy=dd.getYear(),mm=dd.getMonth()+1,dd=dd.getDate(),2e3>yy&&(yy+=1900),10>mm&&(mm="0"+mm),10>dd&&(dd="0"+dd),yy+"/"+mm+"/"+dd},_km.shuffle=function(t){for(var e=t.length;e;){var n=Math.floor(Math.random()*e),s=t[--e];t[e]=t[n],t[n]=s}return t},_km.asort=function(t,e){t.sort(function(t,n){return t[e]>n[e]?1:-1})},_km.asizeof=function(t){var e=0;if(t.length)return t.length;for(var n in t)e++;return e},_km.randget=function(t){var e=randgetkey(t);return t[e]},_km.randgetkey=function(t){var e,n=0,s=0;for(e in t)s++;var i=Math.floor(Math.random()*s);for(e in t){if(i==n)return e;n++}return!1},_km.randint=function(t,e){return Math.floor(Math.random()*(e+1-t))+t},_km.CSSMatrix=window.WebKitCSSMatrix||window.MSCSSMatrix||window.CSSMatrix,!_km.CSSMatrix){var _=/^.*\((.*)\)$/g,y=/\s*,\s*/;_km.CSSMatrix=function(t){for(var e=t.replace(_,"$1").split(y),n=0;n<e.length;n++)e[n]=parseFloat(e[n]);var s=this;16==e.length?(s.m11=s.a=e[0],s.m12=s.b=e[1],s.m13=e[2],s.m14=e[3],s.m21=s.c=e[4],s.m22=s.d=e[5],s.m23=e[6],s.m24=e[7],s.m31=e[8],s.m32=e[9],s.m33=e[10],s.m34=e[11],s.m41=s.e=e[12],s.m42=s.f=e[13],s.m43=e[14],s.m44=e[15]):6==e.length?(s.m11=s.a=e[0],s.m12=s.b=e[1],s.m13=0,s.m14=0,s.m21=s.c=e[2],s.m22=s.d=e[3],s.m23=0,s.m24=0,s.m41=s.e=e[4],s.m42=s.f=e[5],s.m43=0,s.m44=1):(s.m11=s.a=1,s.m12=s.b=0,s.m13=0,s.m14=0,s.m21=s.c=0,s.m22=s.d=1,s.m23=0,s.m24=0,s.m31=0,s.m32=0,s.m33=1,s.m34=0,s.m41=s.e=0,s.m42=s.f=0,s.m43=0,s.m44=1)}}_km.isiOS||_km.isAndroid?_km.isiOS&&(km.sound={sounds:{},bpm:{},mspb:{},beatlen:{},beat:400,loadn:0,len:0,complete:!1,nowplay:"",startTime:0,play:function(t){b("soundplay",t),this.mspb[t]&&(this.beat=this.mspb[t])},stop:function(t){t?b("soundstop",t):b("soundstopall")},bgm:function(t){b("soundbgmplay",t),this.startTime=time(),this.nowplay=t,this.mspb[t]&&(this.beat=this.mspb[t])},init:function(t){this.len=t.length;for(var e=Array(),n=0;n<t.length;n++){console.log(t[n]);var s=t[n].split("#");if(3==s.length){var i=s[0];t[n]=i,this.bpm[i]=s[1]-0,this.mspb[i]=1/(this.bpm[i]/6e4),this.beatlen[i]=s[2]-0,this.sounds[t[n]]=!0}var o=t[n];this.loadn=this.len,this.complete=!0,e.push(o+":"+this.bpm[i])}var a=e.join("|/");b("soundload",a)},loadok:function(){this.loadn++,console.log("sound loadn"+this.loadn),this.len==this.loadn&&(this.complete=!0)},loadWait:function(t){var e=t,n=this;setTimeout(function(){n.deviceload===!1?setTimeout(arguments.callee,100):e()},100)}}):km.sound={play:function(t){km.sounds[t].play()},stop:function(t){t?km.sounds[t].stop():$.each(km.sounds,function(t){km.sounds[t].stop()})},bgm:function(t){km.sounds[t].bgm()},load:function(t,e,n){var s=t.replace(/^(.*\/|)([^\/]+?)\.(mp3|ogg|wav)$/,"$2");km.sounds[s]=new c(s,t,e,n)}};var g=Array(),w=!1,b=function(t,e){if(_km.isiOS){var n="action://"+t+"/"+e;w===!0?g.push(n):(window.location.href=n,w=!0)}else _km.isAndroid};_km.onbeats=[],km.beat=0,km.beatms=400,km.onBeat=function(){},_km.onBeat=function(){var t=Date.now()-km.startTime;console.log(km.beat+" time:"+t+" :"+(t-km.beat*km.beatms));for(var e=_km.onbeats.length,n=0;e>n;n++){var s=_km.onbeats[n],i=$(s).data("kBeat");i?i.apply(s):(_km.onbeats.splice(n,1),n--,e--)}km.onBeat()},km.beatStop=function(){window.clearTimeout(_km.schedulerTimer)},_km.defaultBeat=400,km.nowbgm=null,c.prototype={play:function(){0!=this.bpm&&(km.beat=0,km.beatStop(),km.beatms=this.mspb,km.nowbgm=this.id),this.e.play()},pause:function(){0!=this.bpm&&(km.beatStop(),km.nowbgm=null),this.e.pause()},stop:function(){0!=this.bpm&&(km.beat=0,km.beatStop(),km.nowbgm=null),this.e.stop()},setLoop:function(){this.e.setLoop()},getPosition:function(){return this.e.getPosition()},setPosition:function(t){this.e.setPosition(t)},setVolume:function(t){this.e.setVolume(t)},load:function(t,e,n,s){var i=$("<embed/>").attr({src:[km.swfpath,"?id=",t,"&src=",e,"&bpm=",n].join(""),name:"ksound-"+t,id:"ksound-"+t,allowscriptaccess:"always"}).css({position:"absolute",left:-1,top:0,height:1,width:1}).appendTo("body");this.e=i[0],this.loadComplete=s},_complete:function(){0!=this.bpm&&(km.beat=0,km.beatStop()),this.complete&&this.complete()},_loadComplete:function(){this.loadok=!0,this.loadComplete&&this.loadComplete()},_beatStart:function(){km.startTime=Date.now(),_km.scheduledBeat=0,km.nextBeatTime=km.startTime,_km.scheduler()}},km.nextBeatTime=0,_km.beatQueue=[],_km.scheduler=function(){for(var t=Date.now();km.nextBeatTime<t+200;)_km.beatQueue.push({beat:_km.scheduledBeat,time:km.nextBeatTime}),km.nextBeatTime+=km.beatms,_km.scheduledBeat++;_km.schedulerTimer=window.setTimeout(_km.scheduler,50)},km.frame=0,_km.onupdates=[],km.onUpdate=function(){},_km.onUpdate=function(){for(;_km.beatQueue.length&&_km.beatQueue[0].time<Date.now();)km.beat=_km.beatQueue[0].beat,_km.beatQueue.splice(0,1),_km.onBeat();for(var t=_km.onupdates.length,e=0;t>e;e++){var n=_km.onupdates[e],s=$(n).data("kUpdate");s?s.apply(n):(_km.onupdates.splice(e,1),e--,t--)}km.onUpdate(),km.frame++,requestAnimFrame(_km.onUpdate)},requestAnimFrame(_km.onUpdate)}(jQuery);